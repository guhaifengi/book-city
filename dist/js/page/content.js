define(["jquery","template","text!../../tql/content.html","text!../../tql/menu.html","base64"],function(c,s,i,t){var e=window.localStorage,n=e.getItem("fontSize")||16,a=e.getItem("chapter_id")||1,o=e.getItem("background")||"#f7eee5",r=null;function l(n){e.setItem("chapter_id",n),c.ajax({url:"/book/content?cont="+n,dataType:"json",success:function(n){var t,e,o=n.jsonp;t=o,(e=document.createElement("script")).src=t,window.duokan_fiction_chapter=function(n){var n=JSON.parse(c.base64().decode(n));console.log(n);var t=r.length;c(".content").empty(),s(i,n,".content"),c(".menulist").html(a+"/"+t)},document.head.appendChild(e)}})}function u(n){var t=parseInt(c(".content").css("font-size"));c(".content").css("font-size",t+n),e.setItem("fontSize",t+n),console.log(t+n)}c(".wrap>.content").css("font-size",n+"px"),c(".wrap>.content").css("background",o),c.ajax({url:"/book/menu",dataType:"json",success:function(n){r=n.item.toc,s(t,n.item,".menu-list")}}),l(a),c(".content").on("click",function(){c(".mask").css("display","block")}),c(".mask").on("click",function(){c(".mask").css("display","none")}),c(".menu-btn").on("click",function(){return c(".reader__font").css("display","none"),c(".menu").addClass("show"),!1}),c(".time-btn").on("click",function(){var n=c(this).html();return c(".reader__font").css("display","none"),"白天"==n?(c(".content").css({background:"#f7eee5",color:"#4e534f"}),c(this).html("夜间")):"夜间"==n&&(c(".content").css({background:"#0f1410",color:"#4e534f"}),c(this).html("白天")),!1}),c(".reader__font-bg").on("click","li",function(){var n=c(this).css("background");return c(".content").css("background",n),e.setItem("background",n),!1}),c(".font-btn").on("click",function(){return c(".reader__font").toggle(),!1}),c(".reader__font-large").on("click",function(){return u(2),!1}),c(".reader__font-small").on("click",function(){return u(-2),!1}),c(".menu-list").on("click","li",function(){l(a=c(this).data("id")),c(this).addClass("active").siblings().removeClass("active"),c(".menu").removeClass("show")}),c(".up-btn").on("click",function(){return--a<1&&(a=1),l(a),!1}),c(".down-btn").on("click",function(){return 4<++a&&(a=4),l(a),!1}),c(".top>#Tag__76").on("click",function(){return!(location.href="../../page/content.html")})});